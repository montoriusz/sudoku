var Sudoku=(function(){var d=Math.log(2);function e(k,j){if(!e.areas){c()}this.hash=Date.now().toString(36);this.grid=new Array(81);this.allow=new Array(81);if(k&&k instanceof e){this.parent=j?k:null;this.mod=k.mod;this.complete=k.complete;this.grid=k.grid.slice(0);this.allow=k.allow.slice(0)}else{this.parent=null;this.updateMod();this.complete=0;for(var h=0;h<81;h++){this.grid[h]=0;this.allow[h]=511}}}function c(){var p,h,l,k,m,o;e.areas={rows:new Array(9),cols:new Array(9),boxes:new Array(9)};for(p=0;p<9;++p){e.areas.boxes[p]=m=new Array(9);h=Math.floor(p/3)*27+(p%3)*3;for(var l=0;l<3;++l){for(var k=0;k<3;++k){m[l*3+k]=h+l*9+k}}e.areas.rows[p]=m=new Array(9);e.areas.cols[p]=o=new Array(9);h=p*9;for(var l=0;l<9;++l){m[l]=h+l;o[l]=p+l*9}}}e.fromString=function(l){var j,k,h;if(typeof l!=="string"||l.length!==81){throw new Error("Invalid string to create Sudoku.")}k=new e();for(j=0;j<81;++j){h=+k[j];if(h>=1&&h<=9){k.setCell(j,h)}}return k};e.prototype.toString=function(){return this.grid.join("")};function b(j,h){for(var k=0;k<j.length;++k){if(this.allow[j[k]]!==-1){this.allow[j[k]]&=h}}}function g(i,h){h=~h;b.call(this,e.areas.rows[Math.floor(i/9)],h);b.call(this,e.areas.cols[Math.floor(i%9)],h);b.call(this,e.areas.boxes[Math.floor(i/27)*3+Math.floor(i/3)%3],h)}function f(q,r){var m,l,o,p,n=new Array(),h=new Array(),k;for(m=0;m<9;++m){h[m]=new Array()}for(m=0;m<q.length;++m){o=this.allow[q[m]];if(o===-1){continue}if(o===0){k=new Error("No possibilities at "+a(q[m]));k.sudokuData={cell:q[m],value:null};throw k}if(r&2){p=Math.log(o)/d;if(p%1===0){n.push({cell:q[m],value:p+1})}}if(r&1){for(l=0;l<9;++l){if(o&(1<<l)){h[l].push(q[m])}}}}if(r&1){for(var m=0;m<9;++m){if(h[m].length===1){n.push({cell:h[m][0],value:m+1})}}}for(var m=0;m<n.length;++m){this.setCell(n[m].cell,n[m].value)}}function a(h){var i=1+Math.floor(h/9),j=1+(h%9);return"row "+i+", col "+j}e.prototype.updateMod=function(){this.mod=Date.now()};e.prototype.isDescendant=function(h){if(!(h instanceof e)){throw new Error("Invalid object type.")}while(h.parent instanceof e){if(h.parent===this){return true}h=h.parent}return false};e.prototype.hasValueAt=function(h){return(this.grid[h]!==0)};e.prototype.isAllowedAt=function(i,h){return(this.allow[i]!==-1&&(this.allow[i]&(1<<h-1))!==0)};e.prototype.setCell=function(k,j){var h;j=+j;if(!j||isNaN(j)){h=new Error("Invalid cell value to set at "+a(k)+".");h.sudokuData={cell:k,value:j};throw h}if(this.grid[k]===j){return}var i=1<<(j-1);if(this.grid[k]!==0||(this.allow[k]&i)===0){h=new Error("Setting value "+j+" at "+a(k)+" failed.");h.sudokuData={cell:k,value:j};throw h}this.grid[k]=j;this.allow[k]=-1;this.complete++;g.call(this,k,i);this.updateMod()};e.prototype.clearCell=function(k){var h,j=this.grid;if(this.grid[k]===0){return}this.complete=0;this.grid=new Array(81);j[k]=0;for(h=0;h<81;h++){this.grid[h]=0;this.allow[h]=511}this.updateMod();for(h=0;h<81;h++){if(j[h]!==0){this.setCell(h,j[h])}}};e.prototype.solveStraight=function(l,j){var h;j=j||null;l=l||3;do{h=this.complete;for(var k=0;k<9;k++){f.call(this,e.areas.rows[k],l);f.call(this,e.areas.cols[k],l);f.call(this,e.areas.boxes[k],l)}if(j!==null){--j}}while(this.complete>h&&(j===null||j>0));return this.complete===81?this:false};e.prototype.guess=function(j,k){var n,h,m=new Array(),l=null;for(n=0;n<81;++n){if(this.grid[n]===0){for(h=0;h<9;++h){if(this.allow[n]&&(1<<h)){m.push([n,h+1])}}}}while(m.length){if(k){n=m.splice(Math.floor(Math.random()*m.length),1)[0]}else{n=m.pop()}l=new e(this);try{l.setCell(n[0],n[1]);l=j.call(l,n[0],n[1],this);if(l){return l}}catch(i){}if(k&&--k===0){return false}}return false};e.prototype.solveDeep=function(){return this.solveStraight()||this.guess(function(){return this.solveStraight()||this.complete>63&&this.guess(function(){return this.solveStraight()})})};e.generate=function(k,i){var j=new e(),h=false;do{if(!j.guess(function(l,m){h=this.solveStraight(k,i);j.setCell(l,m);return true},9)){j=new e()}}while(!h||h.complete<81);return j};return e})();